{%- import "icons.html" as icons -%}
{%- let base_path = askama::get_value::<crate::config::uri_path::UriPath>("HTTP_SERVER__BASE_PATH")? -%}

<div class="content-card flex flex-col gap-4"
  hx-ext="morph"
  hx-get="{{base_path}}/ups/{{namespace | urlencode_strict}}/{{device.name | urlencode_strict}}/?tab=clients&section=tab_content"
  hx-trigger="every {{upsd_config.poll_freq}}s"
  hx-swap="morph:innerHTML"
  hx-indicator="#indicator"
  hx-target="#tab-content"
>
  <h2 class="opacity-60 text-lg tracking-wide">Attached Clients</h2>
  <label class="input input-ghost input-sm opacity-60 tracking-wide">
    {%- call icons::get_svg("search", 16) -%}
    <input
      id="client-filter-input"
      placeholder="Filter"
      name="client-filter"
      maxlength="64"
      autocomplete="off"
      hx-preserve
    />
  </label>
  {% if device.attached.is_empty() -%}
    <div id="_empty_row" class="font-light opacity-80 p-16 text-center text-lg">
      No attached client available
    </div>
  {%- else -%}
    <nut-search-list for="client-filter" class="list">
      {%- for client in device.attached.iter() -%}
        <li class="list-row" search-value="{{client.addr}} {{client.name.as_deref().unwrap_or("")}}">
          <div class="text-secondary content-center">{%- call icons::get_svg("monitor", 24) -%}</div>
          <div>
            {%- if let Some(name) = client.name -%}
              <div class="font-bold text-primary">{{name}}</div>
              <div class="font-semibold opacity-50 text-xs">{{client.addr}}</div>
            {%- else -%}
              <div class="font-bold text-primary">{{client.addr}}</div>
            {%- endif -%}
          </div>
        </li>
      {%- endfor -%}
    </nut-search-list>
  {%- endif -%}
</div>
